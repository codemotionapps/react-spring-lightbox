"use strict";var e=require("react"),t=require("styled-components"),n=require("@babel/runtime/helpers/slicedToArray"),r=require("@babel/runtime/helpers/toConsumableArray"),a=require("react-spring"),o=require("react-use-gesture"),i=require("@babel/runtime/helpers/defineProperty"),l=require("@babel/runtime/helpers/classCallCheck"),c=require("@babel/runtime/helpers/createClass"),u=require("@babel/runtime/helpers/assertThisInitialized"),s=require("@babel/runtime/helpers/inherits"),f=require("@babel/runtime/helpers/possibleConstructorReturn"),d=require("@babel/runtime/helpers/getPrototypeOf"),g=require("react-dom");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=m(e),h=m(t),v=m(n),y=m(r),b=m(i),C=m(l),w=m(c),x=m(u),E=m(s),O=m(f),P=m(d),k=m(g),I=function(e){var t=e.imageRef,n=e.scale,r=e.pinchDelta,a=v.default(e.touchOrigin,2),o=a[0],i=a[1],l=v.default(e.currentTranslate,2),c=l[0],u=l[1],s=t.current.getBoundingClientRect(),f=s.top;return[-((o-s.left-s.width/2)/n)*r+c,-((i-f-s.height/2)/n)*r+u]},A=function(e){var t=e.current.getBoundingClientRect(),n=t.top,r=t.left,a=t.bottom,o=t.right,i=window,l=i.innerHeight,c=i.innerWidth;return r>.5*c||n>.5*l||o<.5*c||a<.5*l};function D(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){b.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=["webp","png","jpg","jpeg","gif","svg","bmp"],R=function(t){var n=t.annotations,r=t.renderAnnotation,o=t.store,i=function(){return{scale:.5}},l=a.useSprings(n.length,i),c=v.default(l,2),u=c[0],s=c[1];return e.useEffect((function(){s(i)}),[s]),p.default.createElement("div",{className:"annotations-container"},null==u?void 0:u.map((function(e,t){var i=e.scale,l={top:"".concat(n[t].top,"%"),left:"".concat(n[t].left,"%"),width:20,height:20,zIndex:3,position:"absolute"};return p.default.createElement(a.animated.div,{className:"animated-annotation",style:{transform:a.to([i],(function(e){return"scale(".concat(e,")")}))}},r({annotation:n[t],store:o,style:l}))})))},_=function(t){var n,r=t.image,i=t.src,l=t.alt,c=t.pagerHeight,u=t.isCurrentImage,s=t.setDisableDrag,f=t.singleClickToZoom,d=t.pagerIsDragging,g=t.isAnnotating,m=t.renderAnnotation,h=t.overlayClick,C=t.annotations,w=e.useRef(),x=e.useState(!1),E=v.default(x,2),O=E[0],P=E[1],k=e.useRef(),j=r.pictureHeight/r.pictureWidth,N=function(){return{scale:1,translateX:0,translateY:0,config:T(T({},a.config.default),{},{precision:.01})}},_=a.useSpring((function(){return T(T({},N()),{},{onFrame:function(e){(e.scale<1||!e.pinching)&&z(N),e.scale>1&&A(k)&&z(N())},onRest:function(e){1===e.scale&&s(!1)}})})),B=v.default(_,2),L=B[0],X=L.scale,Y=L.translateX,W=L.translateY,z=B[1];e.useEffect((function(){u||z(N)}));var Z,U,F,K,M,G,V,$,J=o.useGesture({onPinch:function(e){var t=v.default(e.movement,1)[0],n=v.default(e.origin,2),r=n[0],a=n[1],o=e.event,i=e.ctrlKey,l=e.last,c=e.cancel;if(s(!0),t&&!O&&P(!0),l)c();else{var u=i?1e3:250,f=X.goal+t/u,d=f-X.goal,g=o.clientX,m=o.clientY,p=I({imageRef:k,scale:X.goal,pinchDelta:d,currentTranslate:[Y.goal,W.goal],touchOrigin:i?[g,m]:[r,a]}),h=v.default(p,2),y=h[0],b=h[1];z(f<.5?{scale:.5,pinching:!0}:f>3?{scale:3,pinching:!0}:{scale:f,translateX:y,translateY:b,pinching:!0})}},onPinchEnd:function(){X.goal>1?s(!0):z(N),P(!1)},onDragEnd:function(){return setTimeout((function(){P(!1)}),0)},onDrag:function(e){var t=v.default(e.movement,2),n=t[0],r=t[1],a=e.pinching,o=e.event,i=e.cancel,l=e.first,c=e.memo,u=void 0===c?{initialTranslateX:0,initialTranslateY:0}:c;if(n&&r&&!O&&P(!0),!(o.touches&&o.touches.length>1||a||X.goal<=1))return X.goal>1&&A(k)?void i():l?{initialTranslateX:Y.goal,initialTranslateY:W.goal}:(z({translateX:u.initialTranslateX+n,translateY:u.initialTranslateY+r}),u)}},{domTarget:k,event:{passive:!1}});return e.useEffect(J,[J]),n={},b.default(n,f?"onSingleClick":"onDoubleClick",(function(e){if(d||O)e.stopPropagation();else if(1===X.goal){var t=j>2?function(e){var t,n,r=D(y.default(Array(20).keys()));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a>e){t=a-1;break}}}catch(e){r.e(e)}finally{r.f()}return t}(j):1,n=e.clientX,r=e.clientY,a=X.goal+t,o=a-X.goal,i=I({imageRef:k,scale:X.goal,pinchDelta:o,currentTranslate:[Y.goal,W.goal],touchOrigin:[n,r]}),l=v.default(i,2),c=l[0],u=l[1];s(!0),z({scale:a,translateX:c,translateY:u,pinching:!0})}else z(N)})),b.default(n,"ref",k),b.default(n,"latency",f?0:200),U=(Z=n).ref,F=Z.latency,K=void 0===F?300:F,M=Z.onSingleClick,G=void 0===M?function(){return null}:M,V=Z.onDoubleClick,$=void 0===V?function(){return null}:V,e.useEffect((function(){var e=U.current,t=0,n=function(e){t+=1,setTimeout((function(){1===t?G(e):2===t&&$(e),t=0}),K)};return e.addEventListener("click",n),function(){e.removeEventListener("click",n)}})),p.default.createElement(p.default.Fragment,null,p.default.createElement(q,{ref:w,style:T({border:g?"3px solid #fdad1b":"",cursor:g?"crosshair":"",transform:a.to([X,Y,W],(function(e,t,n){return"translate(".concat(t,"px, ").concat(n,"px) scale(").concat(e,")")})),maxHeight:c},u&&{willChange:"transform"}),className:"image-container"},S.includes(r.fileType)&&g&&u?p.default.createElement(R,{rerender:!0,annotations:C,isCurrentImage:u,renderAnnotation:m,store:r.imageAnnotationStore}):null,p.default.createElement(H,{ref:k,className:"lightbox-image",style:T({cursor:g?"crosshair":"",transform:a.to([X,Y,W],(function(e,t,n){return"translate(".concat(t,"px, ").concat(n,"px) scale(").concat(e,")")})),maxHeight:c},u&&{willChange:"transform"}),src:i,alt:l,draggable:"false",onDragStart:function(e){e.preventDefault()},onClick:function(e){if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),g){if(e.ctrlKey||e.metaKey||O)return;h(e)}}})))},q=h.default(a.animated.div).withConfig({displayName:"Image__AnimatedImageContainer",componentId:"sc-1k35vrn-0"})(["z-index:1200;width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),H=h.default(a.animated.img).withConfig({displayName:"Image__AnimatedImage",componentId:"sc-1k35vrn-1"})(["width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),B=function(t){var n=t.images,r=t.currentIndex,i=t.onPrev,l=t.onNext,c=t.onClose,u=t.renderImageOverlay,s=t.renderCustomComponent,f=t.singleClickToZoom,d=t.isAnnotating,g=t.renderAnnotation,m=t.overlayClick,h=t.annotations,b=e.useRef(!0),C=e.useRef(y.default(Array(n.length)).map((function(){return p.default.createRef()}))),w=function(){var t=e.useState({width:window.innerWidth,height:window.innerHeight}),n=v.default(t,2),r=n[0],a=n[1];return e.useEffect((function(){var e=function(){window.innerHeight===r.height&&window.innerWidth===r.width||a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),function(){window.removeEventListener("resize",e),window.addEventListener("orientationchange",e)}})),r}(),x=w.height,E=w.width,O=e.useState(!1),P=v.default(O,2),k=P[0],I=P[1],A=e.useState("100%"),D=v.default(A,2),j=D[0],N=D[1],T=e.useState(!1),S=v.default(T,2),R=S[0],q=S[1],H=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=(e-r)*E+(t?n:0);return e<r-1||e>r+1?{x:a,display:"none"}:{x:a,display:"flex"}},B=a.useSprings(n.length,H),z=v.default(B,2),Z=z[0],U=z[1];e.useEffect((function(){var e=C.current[r].current.clientHeight-50;j!==e&&N(e)}),[r,j,x]),e.useEffect((function(){b.current?b.current=!1:U(H)}));var F=o.useGesture({onDrag:function(e){var t=e.down,n=v.default(e.movement,1)[0],r=v.default(e.direction,1)[0],a=e.velocity,o=e.distance,c=e.cancel,u=e.touches;if(!k&&0!==n){R||q(!0);var s=Math.abs(r)>.7;if(t&&s&&o>E/3.5||t&&s&&a>2){var f=r>0?-1:1;c(),f>0?l():f<0&&i()}u>1||U((function(e){return H(e,t,n)}))}},onDragEnd:function(){return q(!1)}},{domTarget:C.current[r],event:{passive:!0,capture:!1},enabled:Boolean(!n[r].disableDrag||n.length>1)});return e.useEffect((function(){F()}),[F,n,r]),Z.map((function(e,t){var a=e.x,o=e.display;return p.default.createElement(Y,{role:"presentation",ref:C.current[t],key:t,className:"lightbox-image-pager",style:{display:o,transform:a.to((function(e){return"translateX(".concat(e,"px)")}))},onClick:c},s({attachment:n[t],index:t,currentIndex:r}),p.default.createElement(X,null,p.default.createElement(L,null,p.default.createElement(W,{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},p.default.createElement(_,{annotations:h,overlayClick:m,renderAnnotation:g,isAnnotating:d,image:n[t],setDisableDrag:I,src:n[t].src,alt:n[t].alt,pagerHeight:j,isCurrentImage:t===r,pagerIsDragging:R,singleClickToZoom:f}),u({attachment:n[t],index:t,currentIndex:r})))))}))},L=h.default.div.withConfig({displayName:"ImagePager__PagerInnerContentWrapper",componentId:"a18fy4-0"})(["display:flex;justify-content:center;align-items:center;"]),X=h.default.div.withConfig({displayName:"ImagePager__PagerContentWrapper",componentId:"a18fy4-1"})(["width:100%;display:flex;justify-content:center;"]),Y=h.default(a.animated.div).withConfig({displayName:"ImagePager__AnimatedImagePager",componentId:"a18fy4-2"})(["position:absolute;top:0px;left:0px;right:0px;bottom:0px;height:100%;width:100%;will-change:transform;touch-action:none;display:flex;flex-direction:column;justify-content:center;align-items:center;"]),W=h.default.div.withConfig({displayName:"ImagePager__ImageContainer",componentId:"a18fy4-3"})(["position:relative;touch-action:none;user-select:none;"]),z=function(e){var t=e.images,n=e.currentIndex,r=e.onPrev,a=e.onNext,o=e.onClose,i=e.renderPrevButton,l=e.renderNextButton,c=e.renderImageOverlay,u=e.renderCustomComponent,s=e.singleClickToZoom,f=e.isAnnotating,d=e.renderAnnotation,g=e.overlayClick,m=e.annotations,h=n>0,v=n+1<t.length;return p.default.createElement(Z,{className:"lightbox-image-stage"},i({canPrev:h}),p.default.createElement(B,{annotations:m,overlayClick:g,isAnnotating:f,images:t,currentIndex:n,onClose:o,onNext:a,onPrev:r,renderImageOverlay:c,renderCustomComponent:u,renderAnnotation:d,singleClickToZoom:s}),l({canNext:v}))},Z=h.default.div.withConfig({displayName:"ImageStage__ImageStageContainer",componentId:"m6g63l-0"})(["flex-grow:1;position:relative;height:100%;width:100%;display:flex;justify-content:center;align-items:center;"]);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){b.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K=function(e){var t=e.children,n=e.isOpen,r=e.className,o=(e.style,e.pageTransitionConfig),i={from:{transform:"scale(0.75)",opacity:0},enter:{transform:"scale(1)",opacity:1},leave:{transform:"scale(0.75)",opacity:0},config:F(F({},a.config.default),{},{mass:1,tension:320,friction:32})};return a.useTransition(n,F(F({},i),o))((function(e,n,a,o){return n&&p.default.createElement(M,{key:o,className:"lightbox-container".concat(r?" ".concat(r):""),style:e},t)}))},M=h.default(a.animated.div).withConfig({displayName:"PageContainer__AnimatedPageContainer",componentId:"sc-19m9s01-0"})(["display:flex;flex-direction:column;position:fixed;z-index:400;top:0;bottom:0;left:0;right:0;"]);function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P.default(e);if(t){var a=P.default(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return O.default(this,n)}}var V=function(e){E.default(n,e);var t=G(n);function n(){var e;C.default(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),b.default(x.default(e),"preventWheel",(function(e){return e.preventDefault()})),e}return w.default(n,[{key:"componentDidMount",value:function(){this.body=document.body,this.portalContainer=document.createElement("div"),this.portalContainer.setAttribute("class","lightbox-portal"),this.body.appendChild(this.portalContainer),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.body.removeChild(this.portalContainer)}},{key:"render",value:function(){if(void 0===this.portalContainer)return null;var e=this.props.children;return k.default.createPortal(e,this.portalContainer)}}]),n}(p.default.Component),$=function(t){var n=t.isOpen,r=t.onClose,a=t.images,o=t.currentIndex,i=t.onPrev,l=t.onNext,c=t.renderHeader,u=t.renderFooter,s=t.renderPrevButton,f=t.renderNextButton,d=t.renderImageOverlay,g=t.renderCustomComponent,m=t.renderCustomSidebar,h=t.className,v=t.singleClickToZoom,y=t.style,b=t.pageTransitionConfig,C=t.isAnnotating,w=t.renderAnnotation,x=t.overlayClick,E=t.annotations;return e.useEffect((function(){var e=function(e){n&&["ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key)&&e.preventDefault()},t=function(e){if(n)switch(e.key){case"ArrowLeft":i();break;case"ArrowRight":l();break;default:e.preventDefault()}};return document.addEventListener("keyup",t),document.addEventListener("keydown",e),function(){document.removeEventListener("keyup",t),document.removeEventListener("keydown",e)}})),p.default.createElement(V,null,p.default.createElement(K,{isOpen:n,className:h,style:y,pageTransitionConfig:b},c(),p.default.createElement("div",{className:"view-container"},p.default.createElement(J,null,p.default.createElement(z,{annotations:E,overlayClick:x,isAnnotating:C,images:a,onClose:r,currentIndex:o,onPrev:i,onNext:l,renderPrevButton:s,renderNextButton:f,renderImageOverlay:d,renderCustomComponent:g,singleClickToZoom:v,renderAnnotation:w}),u()),m())))};$.defaultProps={pageTransitionConfig:null,className:null,style:null,renderHeader:function(){return null},renderFooter:function(){return null},renderPrevButton:function(){return null},renderNextButton:function(){return null},renderImageOverlay:function(){return null},renderCustomComponent:function(){return null},renderCustomSidebar:function(){return null},singleClickToZoom:!1};var J=h.default.div.withConfig({displayName:"src__ViewContainer",componentId:"sc-1of2zfk-0"})(["display:flex;flex-direction:column;position:relative;z-index:400;top:0;bottom:0;left:0;right:0;width:100%;"]);module.exports=$;
//# sourceMappingURL=index.cjs.js.map
