"use strict";var e=require("react"),t=require("styled-components"),n=require("@babel/runtime/helpers/slicedToArray"),r=require("@babel/runtime/helpers/toConsumableArray"),a=require("react-spring"),i=require("react-use-gesture"),o=require("@babel/runtime/helpers/defineProperty"),l=require("@babel/runtime/helpers/classCallCheck"),u=require("@babel/runtime/helpers/createClass"),c=require("@babel/runtime/helpers/assertThisInitialized"),s=require("@babel/runtime/helpers/inherits"),f=require("@babel/runtime/helpers/possibleConstructorReturn"),d=require("@babel/runtime/helpers/getPrototypeOf"),g=require("react-dom");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=m(e),h=m(t),v=m(n),y=m(r),b=m(o),w=m(l),C=m(u),x=m(c),O=m(s),P=m(f),E=m(d),I=m(g),k=function(e){var t=e.imageRef,n=e.scale,r=e.pinchDelta,a=v.default(e.touchOrigin,2),i=a[0],o=a[1],l=v.default(e.currentTranslate,2),u=l[0],c=l[1],s=t.current.getBoundingClientRect(),f=s.top;return[-((i-s.left-s.width/2)/n)*r+u,-((o-f-s.height/2)/n)*r+c]},D=function(e){var t=e.current.getBoundingClientRect(),n=t.top,r=t.left,a=t.bottom,i=t.right,o=window,l=o.innerHeight,u=o.innerWidth;return r>.5*u||n>.5*l||i<.5*u||a<.5*l};function j(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){b.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=function(t){var n,r=t.image,o=t.src,l=t.alt,u=t.pagerHeight,c=t.isCurrentImage,s=t.setDisableDrag,f=t.singleClickToZoom,d=t.pagerIsDragging,g=e.useState(!1),m=v.default(g,2),h=m[0],w=m[1],C=e.useRef(),x=r.pictureHeight/r.pictureWidth,O=function(){return{scale:1,translateX:0,translateY:0,config:S(S({},a.config.default),{},{precision:.01})}},P=a.useSpring((function(){return S(S({},O()),{},{onFrame:function(e){(e.scale<1||!e.pinching)&&_(O),e.scale>1&&D(C)&&_(O())},onRest:function(e){1===e.scale&&s(!1)}})})),E=v.default(P,2),I=E[0],T=I.scale,N=I.translateX,A=I.translateY,_=E[1];e.useEffect((function(){c||_(O)}));var q=i.useGesture({onPinch:function(e){var t=v.default(e.movement,1)[0],n=v.default(e.origin,2),r=n[0],a=n[1],i=e.event,o=e.ctrlKey,l=e.last,u=e.cancel;if(s(!0),t&&!h&&w(!0),l)u();else{var c=o?1e3:250,f=T.goal+t/c,d=f-T.goal,g=i.clientX,m=i.clientY,p=k({imageRef:C,scale:T.goal,pinchDelta:d,currentTranslate:[N.goal,A.goal],touchOrigin:o?[g,m]:[r,a]}),y=v.default(p,2),b=y[0],x=y[1];_(f<.5?{scale:.5,pinching:!0}:f>3?{scale:3,pinching:!0}:{scale:f,translateX:b,translateY:x,pinching:!0})}},onPinchEnd:function(){T.goal>1?s(!0):_(O),w(!1)},onDragEnd:function(){return w(!1)},onDrag:function(e){var t=v.default(e.movement,2),n=t[0],r=t[1],a=e.pinching,i=e.event,o=e.cancel,l=e.first,u=e.memo,c=void 0===u?{initialTranslateX:0,initialTranslateY:0}:u;if(n&&r&&!h&&w(!0),!(i.touches&&i.touches.length>1||a||T.goal<=1))return T.goal>1&&D(C)?void o():l?{initialTranslateX:N.goal,initialTranslateY:A.goal}:(_({translateX:c.initialTranslateX+n,translateY:c.initialTranslateY+r}),c)}},{domTarget:C,event:{passive:!1}});return e.useEffect(q,[q]),function(t){var n=t.ref,r=t.latency,a=void 0===r?300:r,i=t.onSingleClick,o=void 0===i?function(){return null}:i,l=t.onDoubleClick,u=void 0===l?function(){return null}:l;e.useEffect((function(){var e=n.current,t=0,r=function(e){t+=1,setTimeout((function(){1===t?o(e):2===t&&u(e),t=0}),a)};return e.addEventListener("click",r),function(){e.removeEventListener("click",r)}}))}((n={},b.default(n,f?"onSingleClick":"onDoubleClick",(function(e){if(d||h)e.stopPropagation();else if(1===T.goal){var t=x>2?function(e){var t,n,r=j(y.default(Array(20).keys()));try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a>e){t=a-1;break}}}catch(e){r.e(e)}finally{r.f()}return t}(x):1,n=e.clientX,r=e.clientY,a=T.goal+t,i=a-T.goal,o=k({imageRef:C,scale:T.goal,pinchDelta:i,currentTranslate:[N.goal,A.goal],touchOrigin:[n,r]}),l=v.default(o,2),u=l[0],c=l[1];s(!0),_({scale:a,translateX:u,translateY:c,pinching:!0})}else _(O)})),b.default(n,"ref",C),b.default(n,"latency",f?0:200),n)),p.default.createElement(R,{ref:C,className:"lightbox-image",style:S({transform:a.to([T,N,A],(function(e,t,n){return"translate(".concat(t,"px, ").concat(n,"px) scale(").concat(e,")")})),maxHeight:u},c&&{willChange:"transform"}),src:o,alt:l,draggable:"false",onDragStart:function(e){e.preventDefault()},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}})},R=h.default(a.animated.img).withConfig({displayName:"Image__AnimatedImage",componentId:"sc-1k35vrn-0"})(["width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),_=function(t){var n=t.images,r=t.currentIndex,o=t.onPrev,l=t.onNext,u=t.onClose,c=t.renderImageOverlay,s=t.renderCustomComponent,f=t.singleClickToZoom,d=e.useRef(!0),g=e.useRef(y.default(Array(n.length)).map((function(){return p.default.createRef()}))),m=function(){var t=e.useState({width:window.innerWidth,height:window.innerHeight}),n=v.default(t,2),r=n[0],a=n[1];return e.useEffect((function(){var e=function(){window.innerHeight===r.height&&window.innerWidth===r.width||a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),function(){window.removeEventListener("resize",e),window.addEventListener("orientationchange",e)}})),r}(),h=m.height,b=m.width,w=e.useState(!1),C=v.default(w,2),x=C[0],O=C[1],P=e.useState("100%"),E=v.default(P,2),I=E[0],k=E[1],D=e.useState(!1),j=v.default(D,2),T=j[0],N=j[1],S=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=(e-r)*b+(t?n:0);return e<r-1||e>r+1?{x:a,display:"none"}:{x:a,display:"flex"}},R=a.useSprings(n.length,S),_=v.default(R,2),X=_[0],Y=_[1];e.useEffect((function(){var e=g.current[r].current.clientHeight-50;I!==e&&k(e)}),[r,I,h]),e.useEffect((function(){d.current?d.current=!1:Y(S)}));var W=i.useGesture({onDrag:function(e){var t=e.down,n=v.default(e.movement,1)[0],r=v.default(e.direction,1)[0],a=e.velocity,i=e.distance,u=e.cancel,c=e.touches;if(!x&&0!==n){T||N(!0);var s=Math.abs(r)>.7;if(t&&s&&i>b/3.5||t&&s&&a>2){var f=r>0?-1:1;u(),f>0?l():f<0&&o()}c>1||Y((function(e){return S(e,t,n)}))}},onDragEnd:function(){return N(!1)}},{domTarget:g.current[r],event:{passive:!0,capture:!1},enabled:Boolean(!n[r].disableDrag||n.length>1)});return e.useEffect((function(){W()}),[W,n,r]),X.map((function(e,t){var a=e.x,i=e.display;return p.default.createElement(B,{role:"presentation",ref:g.current[t],key:t,className:"lightbox-image-pager",style:{display:i,transform:a.to((function(e){return"translateX(".concat(e,"px)")}))},onClick:u},s({attachment:n[t],index:t,currentIndex:r}),p.default.createElement(H,null,p.default.createElement(q,null,p.default.createElement(L,{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},p.default.createElement(A,{image:n[t],setDisableDrag:O,src:n[t].src,alt:n[t].alt,pagerHeight:I,isCurrentImage:t===r,pagerIsDragging:T,singleClickToZoom:f}),c({attachment:n[t],index:t,currentIndex:r})))))}))},q=h.default.div.withConfig({displayName:"ImagePager__PagerInnerContentWrapper",componentId:"a18fy4-0"})(["display:flex;justify-content:center;align-items:center;"]),H=h.default.div.withConfig({displayName:"ImagePager__PagerContentWrapper",componentId:"a18fy4-1"})(["width:100%;display:flex;justify-content:center;"]),B=h.default(a.animated.div).withConfig({displayName:"ImagePager__AnimatedImagePager",componentId:"a18fy4-2"})(["position:absolute;top:0px;left:0px;right:0px;bottom:0px;height:100%;width:100%;will-change:transform;touch-action:none;display:flex;flex-direction:column;justify-content:center;align-items:center;"]),L=h.default.div.withConfig({displayName:"ImagePager__ImageContainer",componentId:"a18fy4-3"})(["position:relative;touch-action:none;user-select:none;"]),X=function(e){var t=e.images,n=e.currentIndex,r=e.onPrev,a=e.onNext,i=e.onClose,o=e.renderPrevButton,l=e.renderNextButton,u=e.renderImageOverlay,c=e.renderCustomComponent,s=e.singleClickToZoom,f=n>0,d=n+1<t.length;return p.default.createElement(Y,{className:"lightbox-image-stage"},o({canPrev:f}),p.default.createElement(_,{images:t,currentIndex:n,onClose:i,onNext:a,onPrev:r,renderImageOverlay:u,renderCustomComponent:c,singleClickToZoom:s}),l({canNext:d}))},Y=h.default.div.withConfig({displayName:"ImageStage__ImageStageContainer",componentId:"m6g63l-0"})(["flex-grow:1;position:relative;height:100%;width:100%;display:flex;justify-content:center;align-items:center;"]);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){b.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=function(e){var t=e.children,n=e.isOpen,r=e.className,i=(e.style,e.pageTransitionConfig),o={from:{transform:"scale(0.75)",opacity:0},enter:{transform:"scale(1)",opacity:1},leave:{transform:"scale(0.75)",opacity:0},config:Z(Z({},a.config.default),{},{mass:1,tension:320,friction:32})};return a.useTransition(n,Z(Z({},o),i))((function(e,n,a,i){return n&&p.default.createElement(U,{key:i,className:"lightbox-container".concat(r?" ".concat(r):""),style:e},t)}))},U=h.default(a.animated.div).withConfig({displayName:"PageContainer__AnimatedPageContainer",componentId:"sc-19m9s01-0"})(["display:flex;flex-direction:column;position:fixed;z-index:400;top:0;bottom:0;left:0;right:0;"]);function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var a=E.default(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return P.default(this,n)}}var M=function(e){O.default(n,e);var t=F(n);function n(){var e;w.default(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),b.default(x.default(e),"preventWheel",(function(e){return e.preventDefault()})),e}return C.default(n,[{key:"componentDidMount",value:function(){this.body=document.body,this.portalContainer=document.createElement("div"),this.portalContainer.setAttribute("class","lightbox-portal"),this.body.appendChild(this.portalContainer),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.body.removeChild(this.portalContainer)}},{key:"render",value:function(){if(void 0===this.portalContainer)return null;var e=this.props.children;return I.default.createPortal(e,this.portalContainer)}}]),n}(p.default.Component),G=function(t){var n=t.isOpen,r=t.onClose,a=t.images,i=t.currentIndex,o=t.onPrev,l=t.onNext,u=t.renderHeader,c=t.renderFooter,s=t.renderPrevButton,f=t.renderNextButton,d=t.renderImageOverlay,g=t.renderCustomComponent,m=t.renderCustomSidebar,h=t.className,v=t.singleClickToZoom,y=t.style,b=t.pageTransitionConfig;return e.useEffect((function(){var e=function(e){n&&["ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key)&&e.preventDefault()},t=function(e){if(n)switch(e.key){case"ArrowLeft":o();break;case"ArrowRight":l();break;default:e.preventDefault()}};return document.addEventListener("keyup",t),document.addEventListener("keydown",e),function(){document.removeEventListener("keyup",t),document.removeEventListener("keydown",e)}})),p.default.createElement(M,null,p.default.createElement(z,{isOpen:n,className:h,style:y,pageTransitionConfig:b},u(),p.default.createElement("div",{className:"view-container"},p.default.createElement(K,null,p.default.createElement(X,{images:a,onClose:r,currentIndex:i,onPrev:o,onNext:l,renderPrevButton:s,renderNextButton:f,renderImageOverlay:d,renderCustomComponent:g,singleClickToZoom:v}),c()),m())))};G.defaultProps={pageTransitionConfig:null,className:null,style:null,renderHeader:function(){return null},renderFooter:function(){return null},renderPrevButton:function(){return null},renderNextButton:function(){return null},renderImageOverlay:function(){return null},renderCustomComponent:function(){return null},renderCustomSidebar:function(){return null},singleClickToZoom:!1};var K=h.default.div.withConfig({displayName:"src__ViewContainer",componentId:"sc-1of2zfk-0"})(["display:flex;flex-direction:column;position:relative;z-index:400;top:0;bottom:0;left:0;right:0;width:100%;"]);module.exports=G;
//# sourceMappingURL=index.cjs.js.map
