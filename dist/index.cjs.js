"use strict";var e=require("react"),t=require("styled-components"),n=require("@babel/runtime/helpers/slicedToArray"),r=require("@babel/runtime/helpers/toConsumableArray"),a=require("react-spring"),i=require("react-use-gesture"),o=require("@babel/runtime/helpers/defineProperty"),l=require("@babel/runtime/helpers/classCallCheck"),c=require("@babel/runtime/helpers/createClass"),u=require("@babel/runtime/helpers/assertThisInitialized"),s=require("@babel/runtime/helpers/inherits"),f=require("@babel/runtime/helpers/possibleConstructorReturn"),d=require("@babel/runtime/helpers/getPrototypeOf"),g=require("react-dom");function m(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=m(e),h=m(t),v=m(n),y=m(r),b=m(o),C=m(l),w=m(c),x=m(u),P=m(s),O=m(f),E=m(d),I=m(g),k=function(e){var t=e.imageRef,n=e.scale,r=e.pinchDelta,a=v.default(e.touchOrigin,2),i=a[0],o=a[1],l=v.default(e.currentTranslate,2),c=l[0],u=l[1],s=t.current.getBoundingClientRect(),f=s.top;return[-((i-s.left-s.width/2)/n)*r+c,-((o-f-s.height/2)/n)*r+u]},D=function(e){var t=e.current.getBoundingClientRect(),n=t.top,r=t.left,a=t.bottom,i=t.right,o=window,l=o.innerHeight,c=o.innerWidth;return r>.5*c||n>.5*l||i<.5*c||a<.5*l};function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){b.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var T=function(t){var n,r=t.src,o=t.alt,l=t.pagerHeight,c=t.isCurrentImage,u=t.setDisableDrag,s=t.singleClickToZoom,f=t.pagerIsDragging,d=e.useState(!1),g=v.default(d,2),m=g[0],h=g[1],y=e.useRef(),C=function(){return{scale:1,translateX:0,translateY:0,config:N(N({},a.config.default),{},{precision:.01})}},w=a.useSpring((function(){return N(N({},C()),{},{onFrame:function(e){(e.scale<1||!e.pinching)&&j(C),e.scale>1&&D(y)&&j(C())},onRest:function(e){1===e.scale&&u(!1)}})})),x=v.default(w,2),P=x[0],O=P.scale,E=P.translateX,I=P.translateY,j=x[1];e.useEffect((function(){c||j(C)}));var T=i.useGesture({onPinch:function(e){var t=v.default(e.movement,1)[0],n=v.default(e.origin,2),r=n[0],a=n[1],i=e.event,o=e.ctrlKey,l=e.last,c=e.cancel;if(u(!0),t&&!m&&h(!0),l)c();else{var s=o?1e3:250,f=O.goal+t/s,d=f-O.goal,g=i.clientX,p=i.clientY,b=k({imageRef:y,scale:O.goal,pinchDelta:d,currentTranslate:[E.goal,I.goal],touchOrigin:o?[g,p]:[r,a]}),C=v.default(b,2),w=C[0],x=C[1];j(f<.5?{scale:.5,pinching:!0}:f>3?{scale:3,pinching:!0}:{scale:f,translateX:w,translateY:x,pinching:!0})}},onPinchEnd:function(){O.goal>1?u(!0):j(C),h(!1)},onDragEnd:function(){return h(!1)},onDrag:function(e){var t=v.default(e.movement,2),n=t[0],r=t[1],a=e.pinching,i=e.event,o=e.cancel,l=e.first,c=e.memo,u=void 0===c?{initialTranslateX:0,initialTranslateY:0}:c;if(n&&r&&!m&&h(!0),!(i.touches&&i.touches.length>1||a||O.goal<=1))return O.goal>1&&D(y)?void o():l?{initialTranslateX:E.goal,initialTranslateY:I.goal}:(j({translateX:u.initialTranslateX+n,translateY:u.initialTranslateY+r}),u)}},{domTarget:y,event:{passive:!1}});return e.useEffect(T,[T]),function(t){var n=t.ref,r=t.latency,a=void 0===r?300:r,i=t.onSingleClick,o=void 0===i?function(){return null}:i,l=t.onDoubleClick,c=void 0===l?function(){return null}:l;e.useEffect((function(){var e=n.current,t=0,r=function(e){t+=1,setTimeout((function(){1===t?o(e):2===t&&c(e),t=0}),a)};return e.addEventListener("click",r),function(){e.removeEventListener("click",r)}}))}((n={},b.default(n,s?"onSingleClick":"onDoubleClick",(function(e){if(f||m)e.stopPropagation();else if(1===O.goal){var t=e.clientX,n=e.clientY,r=O.goal+1,a=r-O.goal,i=k({imageRef:y,scale:O.goal,pinchDelta:a,currentTranslate:[E.goal,I.goal],touchOrigin:[t,n]}),o=v.default(i,2),l=o[0],c=o[1];u(!0),j({scale:r,translateX:l,translateY:c,pinching:!0})}else j(C)})),b.default(n,"ref",y),b.default(n,"latency",s?0:200),n)),p.default.createElement(S,{ref:y,className:"lightbox-image",style:N({transform:a.to([O,E,I],(function(e,t,n){return"translate(".concat(t,"px, ").concat(n,"px) scale(").concat(e,")")})),maxHeight:l},c&&{willChange:"transform"}),src:r,alt:o,draggable:"false",onDragStart:function(e){e.preventDefault()},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}})},S=h.default(a.animated.img).withConfig({displayName:"Image__AnimatedImage",componentId:"sc-1k35vrn-0"})(["width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),R=function(t){var n=t.images,r=t.currentIndex,o=t.onPrev,l=t.onNext,c=t.onClose,u=t.renderImageOverlay,s=t.renderCustomComponent,f=t.singleClickToZoom,d=e.useRef(!0),g=e.useRef(y.default(Array(n.length)).map((function(){return p.default.createRef()}))),m=function(){var t=e.useState({width:window.innerWidth,height:window.innerHeight}),n=v.default(t,2),r=n[0],a=n[1];return e.useEffect((function(){var e=function(){window.innerHeight===r.height&&window.innerWidth===r.width||a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),function(){window.removeEventListener("resize",e),window.addEventListener("orientationchange",e)}})),r}(),h=m.height,b=m.width,C=e.useState(!1),w=v.default(C,2),x=w[0],P=w[1],O=e.useState("100%"),E=v.default(O,2),I=E[0],k=E[1],D=e.useState(!1),j=v.default(D,2),N=j[0],S=j[1],R=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=(e-r)*b+(t?n:0);return e<r-1||e>r+1?{x:a,display:"none"}:{x:a,display:"flex"}},H=a.useSprings(n.length,R),L=v.default(H,2),X=L[0],Y=L[1];e.useEffect((function(){var e=g.current[r].current.clientHeight-50;I!==e&&k(e)}),[r,I,h]),e.useEffect((function(){d.current?d.current=!1:Y(R)}));var W=i.useGesture({onDrag:function(e){var t=e.down,n=v.default(e.movement,1)[0],r=v.default(e.direction,1)[0],a=e.velocity,i=e.distance,c=e.cancel,u=e.touches;if(!x&&0!==n){N||S(!0);var s=Math.abs(r)>.7;if(t&&s&&i>b/3.5||t&&s&&a>2){var f=r>0?-1:1;c(),f>0?l():f<0&&o()}u>1||Y((function(e){return R(e,t,n)}))}},onDragEnd:function(){return S(!1)}},{domTarget:g.current[r],event:{passive:!0,capture:!1},enabled:Boolean(!n[r].disableDrag||n.length>1)});return e.useEffect((function(){W()}),[W,n,r]),X.map((function(e,t){var a=e.x,i=e.display;return p.default.createElement(A,{role:"presentation",ref:g.current[t],key:t,className:"lightbox-image-pager",style:{display:i,transform:a.to((function(e){return"translateX(".concat(e,"px)")}))},onClick:c},s({attachment:n[t],index:t,currentIndex:r}),p.default.createElement(q,null,p.default.createElement(_,null,p.default.createElement(B,{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},p.default.createElement(T,{setDisableDrag:P,src:n[t].src,alt:n[t].alt,pagerHeight:I,isCurrentImage:t===r,pagerIsDragging:N,singleClickToZoom:f}),u({attachment:n[t],index:t,currentIndex:r})))))}))},_=h.default.div.withConfig({displayName:"ImagePager__PagerInnerContentWrapper",componentId:"a18fy4-0"})(["display:flex;justify-content:center;align-items:center;"]),q=h.default.div.withConfig({displayName:"ImagePager__PagerContentWrapper",componentId:"a18fy4-1"})(["width:100%;display:flex;justify-content:center;"]),A=h.default(a.animated.div).withConfig({displayName:"ImagePager__AnimatedImagePager",componentId:"a18fy4-2"})(["position:absolute;top:0px;left:0px;right:0px;bottom:0px;height:100%;width:100%;will-change:transform;touch-action:none;display:flex;flex-direction:column;justify-content:center;align-items:center;"]),B=h.default.div.withConfig({displayName:"ImagePager__ImageContainer",componentId:"a18fy4-3"})(["position:relative;touch-action:none;user-select:none;"]),H=function(e){var t=e.images,n=e.currentIndex,r=e.onPrev,a=e.onNext,i=e.onClose,o=e.renderPrevButton,l=e.renderNextButton,c=e.renderImageOverlay,u=e.renderCustomComponent,s=e.singleClickToZoom,f=n>0,d=n+1<t.length;return p.default.createElement(L,{className:"lightbox-image-stage"},o({canPrev:f}),p.default.createElement(R,{images:t,currentIndex:n,onClose:i,onNext:a,onPrev:r,renderImageOverlay:c,renderCustomComponent:u,singleClickToZoom:s}),l({canNext:d}))},L=h.default.div.withConfig({displayName:"ImageStage__ImageStageContainer",componentId:"m6g63l-0"})(["flex-grow:1;position:relative;height:100%;width:100%;display:flex;justify-content:center;align-items:center;"]);function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){b.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var W=function(e){var t=e.children,n=e.isOpen,r=e.className,i=(e.style,e.pageTransitionConfig),o={from:{transform:"scale(0.75)",opacity:0},enter:{transform:"scale(1)",opacity:1},leave:{transform:"scale(0.75)",opacity:0},config:Y(Y({},a.config.default),{},{mass:1,tension:320,friction:32})};return a.useTransition(n,Y(Y({},o),i))((function(e,n,a,i){return n&&p.default.createElement(Z,{key:i,className:"lightbox-container".concat(r?" ".concat(r):""),style:e},t)}))},Z=h.default(a.animated.div).withConfig({displayName:"PageContainer__AnimatedPageContainer",componentId:"sc-19m9s01-0"})(["display:flex;flex-direction:column;position:fixed;z-index:400;top:0;bottom:0;left:0;right:0;"]);function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E.default(e);if(t){var a=E.default(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return O.default(this,n)}}var U=function(e){P.default(n,e);var t=z(n);function n(){var e;C.default(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),b.default(x.default(e),"preventWheel",(function(e){return e.preventDefault()})),e}return w.default(n,[{key:"componentDidMount",value:function(){this.body=document.body,this.portalContainer=document.createElement("div"),this.portalContainer.setAttribute("class","lightbox-portal"),this.body.appendChild(this.portalContainer),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.body.removeChild(this.portalContainer)}},{key:"render",value:function(){if(void 0===this.portalContainer)return null;var e=this.props.children;return I.default.createPortal(e,this.portalContainer)}}]),n}(p.default.Component),F=function(t){var n=t.isOpen,r=t.onClose,a=t.images,i=t.currentIndex,o=t.onPrev,l=t.onNext,c=t.renderHeader,u=t.renderFooter,s=t.renderPrevButton,f=t.renderNextButton,d=t.renderImageOverlay,g=t.renderCustomComponent,m=t.renderCustomSidebar,h=t.className,v=t.singleClickToZoom,y=t.style,b=t.pageTransitionConfig;return e.useEffect((function(){var e=function(e){n&&["ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key)&&e.preventDefault()},t=function(e){if(n)switch(e.key){case"ArrowLeft":o();break;case"ArrowRight":l();break;default:e.preventDefault()}};return document.addEventListener("keyup",t),document.addEventListener("keydown",e),function(){document.removeEventListener("keyup",t),document.removeEventListener("keydown",e)}})),p.default.createElement(U,null,p.default.createElement(W,{isOpen:n,className:h,style:y,pageTransitionConfig:b},c(),p.default.createElement("div",{className:"view-container"},p.default.createElement(G,null,p.default.createElement(H,{images:a,onClose:r,currentIndex:i,onPrev:o,onNext:l,renderPrevButton:s,renderNextButton:f,renderImageOverlay:d,renderCustomComponent:g,singleClickToZoom:v}),u()),m())))};F.defaultProps={pageTransitionConfig:null,className:null,style:null,renderHeader:function(){return null},renderFooter:function(){return null},renderPrevButton:function(){return null},renderNextButton:function(){return null},renderImageOverlay:function(){return null},renderCustomComponent:function(){return null},renderCustomSidebar:function(){return null},singleClickToZoom:!1};var G=h.default.div.withConfig({displayName:"src__ViewContainer",componentId:"sc-1of2zfk-0"})(["display:flex;flex-direction:column;position:relative;z-index:400;top:0;bottom:0;left:0;right:0;width:100%;"]);module.exports=F;
//# sourceMappingURL=index.cjs.js.map
