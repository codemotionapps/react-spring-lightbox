import e,{useEffect as n,useState as t,useRef as r}from"react";import o from"styled-components";import i from"@babel/runtime/helpers/slicedToArray";import a from"@babel/runtime/helpers/toConsumableArray";import{useSpring as l,config as c,to as s,animated as u,useSprings as m,useTransition as f}from"react-spring";import{useGesture as g}from"react-use-gesture";import d from"@babel/runtime/helpers/defineProperty";import p from"@babel/runtime/helpers/classCallCheck";import h from"@babel/runtime/helpers/createClass";import v from"@babel/runtime/helpers/assertThisInitialized";import y from"@babel/runtime/helpers/inherits";import b from"@babel/runtime/helpers/possibleConstructorReturn";import C from"@babel/runtime/helpers/getPrototypeOf";import w from"react-dom";var x=function(e){var n=e.imageRef,t=e.scale,r=e.pinchDelta,o=i(e.touchOrigin,2),a=o[0],l=o[1],c=i(e.currentTranslate,2),s=c[0],u=c[1],m=n.current.getBoundingClientRect(),f=m.top;return[-((a-m.left-m.width/2)/t)*r+s,-((l-f-m.height/2)/t)*r+u]},O=function(e){var n=e.current.getBoundingClientRect(),t=n.top,r=n.left,o=n.bottom,i=n.right,a=window,l=a.innerHeight,c=a.innerWidth;return r>.5*c||t>.5*l||i<.5*c||o<.5*l};function P(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"==typeof e)return k(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return k(e,n)}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(l)throw i}}}}function k(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function I(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function E(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?I(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var A=["image/webp","image/png","image/jpg","image/jpeg","image/gif","image/svg","image/bmp","webp","png","jpg","jpeg","gif","svg","bmp"],D=function(t){var r=t.annotations,o=t.renderAnnotation,a=t.store,l=function(){return{scale:.5}},c=m(r.length,l),f=i(c,2),g=f[0],d=f[1];return n((function(){d(l)}),[d]),e.createElement("div",{className:"annotations-container"},null==g?void 0:g.map((function(n,t){var i=n.scale,l={top:"".concat(r[t].top,"%"),left:"".concat(r[t].left,"%"),width:20,height:20,zIndex:3,position:"absolute"};return e.createElement(u.div,{className:"animated-annotation",style:{transform:s([i],(function(e){return"scale(".concat(e,")")}))}},o({annotation:r[t],store:a,style:l}))})))},j=function(o){var u,m=o.image,f=o.src,p=o.alt,h=o.pagerHeight,v=o.isCurrentImage,y=o.setDisableDrag,b=o.singleClickToZoom,C=o.pagerIsDragging,w=o.isAnnotating,k=o.renderAnnotation,I=o.overlayClick,j=o.annotations,S=r(),_=t(!1),R=i(_,2),H=R[0],B=R[1],L=r(),X=m.pictureHeight/m.pictureWidth,Y=function(){return{scale:1,translateX:0,translateY:0,config:E(E({},c.default),{},{precision:.01})}},W=l((function(){return E(E({},Y()),{},{onFrame:function(e){(e.scale<1||!e.pinching)&&M(Y),e.scale>1&&O(L)&&M(Y())},onRest:function(e){1===e.scale&&y(!1)}})})),z=i(W,2),Z=z[0],U=Z.scale,F=Z.translateX,K=Z.translateY,M=z[1];n((function(){v||M(Y)}));var V,$,q,G,J,Q,ee,ne,te=g({onPinch:function(e){var n=i(e.movement,1)[0],t=i(e.origin,2),r=t[0],o=t[1],a=e.event,l=e.ctrlKey,c=e.last,s=e.cancel;if(y(!0),n&&!H&&B(!0),c)s();else{var u=l?1e3:250,m=U.goal+n/u,f=m-U.goal,g=a.clientX,d=a.clientY,p=x({imageRef:L,scale:U.goal,pinchDelta:f,currentTranslate:[F.goal,K.goal],touchOrigin:l?[g,d]:[r,o]}),h=i(p,2),v=h[0],b=h[1];M(m<.5?{scale:.5,pinching:!0}:m>3?{scale:3,pinching:!0}:{scale:m,translateX:v,translateY:b,pinching:!0})}},onPinchEnd:function(){U.goal>1?y(!0):M(Y),B(!1)},onDragEnd:function(){return setTimeout((function(){B(!1)}),0)},onDrag:function(e){var n=i(e.movement,2),t=n[0],r=n[1],o=e.pinching,a=e.event,l=e.cancel,c=e.first,s=e.memo,u=void 0===s?{initialTranslateX:0,initialTranslateY:0}:s;if(t&&r&&!H&&B(!0),!(a.touches&&a.touches.length>1||o||U.goal<=1))return U.goal>1&&O(L)?void l():c?{initialTranslateX:F.goal,initialTranslateY:K.goal}:(M({translateX:u.initialTranslateX+t,translateY:u.initialTranslateY+r}),u)}},{domTarget:L,event:{passive:!1}});return n(te,[te]),d(u={},b?"onSingleClick":"onDoubleClick",(function(e){if(C||H)e.stopPropagation();else if(1===U.goal){var n=X>2?function(e){var n,t,r=P(a(Array(20).keys()));try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o>e){n=o-1;break}}}catch(e){r.e(e)}finally{r.f()}return n}(X):1,t=e.clientX,r=e.clientY,o=U.goal+n,l=o-U.goal,c=x({imageRef:L,scale:U.goal,pinchDelta:l,currentTranslate:[F.goal,K.goal],touchOrigin:[t,r]}),s=i(c,2),u=s[0],m=s[1];y(!0),M({scale:o,translateX:u,translateY:m,pinching:!0})}else M(Y)})),d(u,"ref",L),d(u,"latency",b?0:200),$=(V=u).ref,q=V.latency,G=void 0===q?300:q,J=V.onSingleClick,Q=void 0===J?function(){return null}:J,ee=V.onDoubleClick,ne=void 0===ee?function(){return null}:ee,n((function(){var e=$.current,n=0,t=function(e){n+=1,setTimeout((function(){1===n?Q(e):2===n&&ne(e),n=0}),G)};return e.addEventListener("click",t),function(){e.removeEventListener("click",t)}})),e.createElement(e.Fragment,null,e.createElement(N,{ref:S,style:E({border:w?"3px solid #fdad1b":"",cursor:w?"crosshair":"",transform:s([U,F,K],(function(e,n,t){return"translate(".concat(n,"px, ").concat(t,"px) scale(").concat(e,")")})),maxHeight:h},v&&{willChange:"transform"}),className:"image-container"},A.includes(m.fileType)&&w&&v?e.createElement(D,{rerender:!0,annotations:j,isCurrentImage:v,renderAnnotation:k,store:m.imageAnnotationStore}):null,e.createElement(T,{ref:L,className:"lightbox-image",style:E({cursor:w?"crosshair":"",transform:s([U,F,K],(function(e,n,t){return"translate(".concat(n,"px, ").concat(t,"px) scale(").concat(e,")")})),maxHeight:h},v&&{willChange:"transform"}),src:f,alt:p,draggable:"false",onDragStart:function(e){e.preventDefault()},onClick:function(e){if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),w){if(e.ctrlKey||e.metaKey||H)return;I(e)}}})))},N=o(u.div).withConfig({displayName:"Image__AnimatedImageContainer",componentId:"sc-1k35vrn-0"})(["z-index:1200;width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),T=o(u.img).withConfig({displayName:"Image__AnimatedImage",componentId:"sc-1k35vrn-1"})(["width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),S=function(o){var l=o.images,c=o.currentIndex,s=o.onPrev,u=o.onNext,f=o.onClose,d=o.renderImageOverlay,p=o.renderCustomComponent,h=o.singleClickToZoom,v=o.isAnnotating,y=o.renderAnnotation,b=o.overlayClick,C=o.annotations,w=r(!0),x=r(a(Array(l.length)).map((function(){return e.createRef()}))),O=function(){var e=t({width:window.innerWidth,height:window.innerHeight}),r=i(e,2),o=r[0],a=r[1];return n((function(){var e=function(){window.innerHeight===o.height&&window.innerWidth===o.width||a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),function(){window.removeEventListener("resize",e),window.addEventListener("orientationchange",e)}})),o}(),P=O.height,k=O.width,I=t(!1),E=i(I,2),A=E[0],D=E[1],N=t("100%"),T=i(N,2),S=T[0],L=T[1],X=t(!1),Y=i(X,2),W=Y[0],z=Y[1],Z=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(e-c)*k+(n?t:0);return e<c-1||e>c+1?{x:r,display:"none"}:{x:r,display:"flex"}},U=m(l.length,Z),F=i(U,2),K=F[0],M=F[1];n((function(){var e=x.current[c].current.clientHeight-50;S!==e&&L(e)}),[c,S,P]),n((function(){w.current?w.current=!1:M(Z)}));var V=g({onDrag:function(e){var n=e.down,t=i(e.movement,1)[0],r=i(e.direction,1)[0],o=e.velocity,a=e.distance,l=e.cancel,c=e.touches;if(!A&&0!==t){W||z(!0);var m=Math.abs(r)>.7;if(n&&m&&a>k/3.5||n&&m&&o>2){var f=r>0?-1:1;l(),f>0?u():f<0&&s()}c>1||M((function(e){return Z(e,n,t)}))}},onDragEnd:function(){return z(!1)}},{domTarget:x.current[c],event:{passive:!0,capture:!1},enabled:Boolean(!l[c].disableDrag||l.length>1)});return n((function(){V()}),[V,l,c]),K.map((function(n,t){var r=n.x,o=n.display;return e.createElement(H,{role:"presentation",ref:x.current[t],key:t,className:"lightbox-image-pager",style:{display:o,transform:r.to((function(e){return"translateX(".concat(e,"px)")}))},onClick:f},p({attachment:l[t],index:t,currentIndex:c}),e.createElement(R,null,e.createElement(_,null,e.createElement(B,{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},e.createElement(j,{annotations:C,overlayClick:b,renderAnnotation:y,isAnnotating:v,image:l[t],setDisableDrag:D,src:l[t].src,alt:l[t].alt,pagerHeight:S,isCurrentImage:t===c,pagerIsDragging:W,singleClickToZoom:h}),d({attachment:l[t],index:t,currentIndex:c})))))}))},_=o.div.withConfig({displayName:"ImagePager__PagerInnerContentWrapper",componentId:"a18fy4-0"})(["display:flex;justify-content:center;align-items:center;"]),R=o.div.withConfig({displayName:"ImagePager__PagerContentWrapper",componentId:"a18fy4-1"})(["width:100%;display:flex;justify-content:center;"]),H=o(u.div).withConfig({displayName:"ImagePager__AnimatedImagePager",componentId:"a18fy4-2"})(["position:absolute;top:0px;left:0px;right:0px;bottom:0px;height:100%;width:100%;will-change:transform;touch-action:none;display:flex;flex-direction:column;justify-content:center;align-items:center;"]),B=o.div.withConfig({displayName:"ImagePager__ImageContainer",componentId:"a18fy4-3"})(["position:relative;touch-action:none;user-select:none;"]),L=function(n){var t=n.images,r=n.currentIndex,o=n.onPrev,i=n.onNext,a=n.onClose,l=n.renderPrevButton,c=n.renderNextButton,s=n.renderImageOverlay,u=n.renderCustomComponent,m=n.singleClickToZoom,f=n.isAnnotating,g=n.renderAnnotation,d=n.overlayClick,p=n.annotations,h=r>0,v=r+1<t.length;return e.createElement(X,{className:"lightbox-image-stage"},l({canPrev:h}),e.createElement(S,{annotations:p,overlayClick:d,isAnnotating:f,images:t,currentIndex:r,onClose:a,onNext:i,onPrev:o,renderImageOverlay:s,renderCustomComponent:u,renderAnnotation:g,singleClickToZoom:m}),c({canNext:v}))},X=o.div.withConfig({displayName:"ImageStage__ImageStageContainer",componentId:"m6g63l-0"})(["flex-grow:1;position:relative;height:100%;width:100%;display:flex;justify-content:center;align-items:center;"]);function Y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function W(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Y(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var z=function(n){var t=n.children,r=n.isOpen,o=n.className,i=(n.style,n.pageTransitionConfig),a={from:{transform:"scale(0.75)",opacity:0},enter:{transform:"scale(1)",opacity:1},leave:{transform:"scale(0.75)",opacity:0},config:W(W({},c.default),{},{mass:1,tension:320,friction:32})};return f(r,W(W({},a),i))((function(n,r,i,a){return r&&e.createElement(Z,{key:a,className:"lightbox-container".concat(o?" ".concat(o):""),style:n},t)}))},Z=o(u.div).withConfig({displayName:"PageContainer__AnimatedPageContainer",componentId:"sc-19m9s01-0"})(["display:flex;flex-direction:column;position:fixed;z-index:400;top:0;bottom:0;left:0;right:0;"]);function U(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=C(e);if(n){var o=C(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return b(this,t)}}var F=function(e){y(t,e);var n=U(t);function t(){var e;p(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=n.call.apply(n,[this].concat(o)),d(v(e),"preventWheel",(function(e){return e.preventDefault()})),e}return h(t,[{key:"componentDidMount",value:function(){this.body=document.body,this.portalContainer=document.createElement("div"),this.portalContainer.setAttribute("class","lightbox-portal"),this.body.appendChild(this.portalContainer),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.body.removeChild(this.portalContainer)}},{key:"render",value:function(){if(void 0===this.portalContainer)return null;var e=this.props.children;return w.createPortal(e,this.portalContainer)}}]),t}(e.Component),K=function(t){var r=t.isOpen,o=t.onClose,i=t.images,a=t.currentIndex,l=t.onPrev,c=t.onNext,s=t.renderHeader,u=t.renderFooter,m=t.renderPrevButton,f=t.renderNextButton,g=t.renderImageOverlay,d=t.renderCustomComponent,p=t.renderCustomSidebar,h=t.className,v=t.singleClickToZoom,y=t.style,b=t.pageTransitionConfig,C=t.isAnnotating,w=t.renderAnnotation,x=t.overlayClick,O=t.annotations;return n((function(){var e=function(e){r&&["ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key)&&e.preventDefault()},n=function(e){if(r)switch(e.key){case"ArrowLeft":l();break;case"ArrowRight":c();break;default:e.preventDefault()}};return document.addEventListener("keyup",n),document.addEventListener("keydown",e),function(){document.removeEventListener("keyup",n),document.removeEventListener("keydown",e)}})),e.createElement(F,null,e.createElement(z,{isOpen:r,className:h,style:y,pageTransitionConfig:b},s(),e.createElement("div",{className:"view-container"},e.createElement(M,null,e.createElement(L,{annotations:O,overlayClick:x,isAnnotating:C,images:i,onClose:o,currentIndex:a,onPrev:l,onNext:c,renderPrevButton:m,renderNextButton:f,renderImageOverlay:g,renderCustomComponent:d,singleClickToZoom:v,renderAnnotation:w}),u()),p())))};K.defaultProps={pageTransitionConfig:null,className:null,style:null,renderHeader:function(){return null},renderFooter:function(){return null},renderPrevButton:function(){return null},renderNextButton:function(){return null},renderImageOverlay:function(){return null},renderCustomComponent:function(){return null},renderCustomSidebar:function(){return null},singleClickToZoom:!1};var M=o.div.withConfig({displayName:"src__ViewContainer",componentId:"sc-1of2zfk-0"})(["display:flex;flex-direction:column;position:relative;z-index:400;top:0;bottom:0;left:0;right:0;width:100%;"]);export default K;
//# sourceMappingURL=index.es.js.map
