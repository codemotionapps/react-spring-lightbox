import e,{useEffect as n,useState as t,useRef as r}from"react";import i from"styled-components";import o from"@babel/runtime/helpers/slicedToArray";import a from"@babel/runtime/helpers/toConsumableArray";import{useSpring as l,config as c,to as s,animated as u,useSprings as m,useTransition as f}from"react-spring";import{useGesture as p}from"react-use-gesture";import d from"@babel/runtime/helpers/defineProperty";import g from"@babel/runtime/helpers/classCallCheck";import v from"@babel/runtime/helpers/createClass";import h from"@babel/runtime/helpers/assertThisInitialized";import y from"@babel/runtime/helpers/inherits";import b from"@babel/runtime/helpers/possibleConstructorReturn";import C from"@babel/runtime/helpers/getPrototypeOf";import w from"react-dom";var x=function(e){var n=e.imageRef,t=e.scale,r=e.pinchDelta,i=o(e.touchOrigin,2),a=i[0],l=i[1],c=o(e.currentTranslate,2),s=c[0],u=c[1],m=n.current.getBoundingClientRect(),f=m.top;return[-((a-m.left-m.width/2)/t)*r+s,-((l-f-m.height/2)/t)*r+u]},P=function(e){var n=e.current.getBoundingClientRect(),t=n.top,r=n.left,i=n.bottom,o=n.right,a=window,l=a.innerHeight,c=a.innerWidth;return r>.5*c||t>.5*l||o<.5*c||i<.5*l};function O(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function I(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var k=function(i){var a,u=i.src,m=i.alt,f=i.pagerHeight,g=i.isCurrentImage,v=i.setDisableDrag,h=i.singleClickToZoom,y=i.pagerIsDragging,b=t(!1),C=o(b,2),w=C[0],O=C[1],k=r(),D=function(){return{scale:1,translateX:0,translateY:0,config:I(I({},c.default),{},{precision:.01})}},N=l((function(){return I(I({},D()),{},{onFrame:function(e){(e.scale<1||!e.pinching)&&S(D),e.scale>1&&P(k)&&S(D())},onRest:function(e){1===e.scale&&v(!1)}})})),j=o(N,2),T=j[0],_=T.scale,R=T.translateX,A=T.translateY,S=j[1];n((function(){g||S(D)}));var B=p({onPinch:function(e){var n=o(e.movement,1)[0],t=o(e.origin,2),r=t[0],i=t[1],a=e.event,l=e.ctrlKey,c=e.last,s=e.cancel;if(v(!0),n&&!w&&O(!0),c)s();else{var u=l?1e3:250,m=_.value+n/u,f=m-_.value,p=a.clientX,d=a.clientY,g=x({imageRef:k,scale:_.value,pinchDelta:f,currentTranslate:[R.value,A.value],touchOrigin:l?[p,d]:[r,i]}),h=o(g,2),y=h[0],b=h[1];S(m<.5?{scale:.5,pinching:!0}:m>3?{scale:3,pinching:!0}:{scale:m,translateX:y,translateY:b,pinching:!0})}},onPinchEnd:function(){_.value>1?v(!0):S(D),O(!1)},onDragEnd:function(){return O(!1)},onDrag:function(e){var n=o(e.movement,2),t=n[0],r=n[1],i=e.pinching,a=e.event,l=e.cancel,c=e.first,s=e.memo,u=void 0===s?{initialTranslateX:0,initialTranslateY:0}:s;if(t&&r&&!w&&O(!0),!(a.touches&&a.touches.length>1||i||_.value<=1))return _.value>1&&P(k)?void l():c?{initialTranslateX:R.value,initialTranslateY:A.value}:(S({translateX:u.initialTranslateX+t,translateY:u.initialTranslateY+r}),u)}},{domTarget:k,event:{passive:!1}});return n(B,[B]),function(e){var t=e.ref,r=e.latency,i=void 0===r?300:r,o=e.onSingleClick,a=void 0===o?function(){return null}:o,l=e.onDoubleClick,c=void 0===l?function(){return null}:l;n((function(){var e=t.current,n=0,r=function(e){n+=1,setTimeout((function(){1===n?a(e):2===n&&c(e),n=0}),i)};return e.addEventListener("click",r),function(){e.removeEventListener("click",r)}}))}((d(a={},h?"onSingleClick":"onDoubleClick",(function(e){if(y||w)e.stopPropagation();else if(1===_.value){var n=e.clientX,t=e.clientY,r=_.value+1,i=r-_.value,a=x({imageRef:k,scale:_.value,pinchDelta:i,currentTranslate:[R.value,A.value],touchOrigin:[n,t]}),l=o(a,2),c=l[0],s=l[1];v(!0),S({scale:r,translateX:c,translateY:s,pinching:!0})}else S(D)})),d(a,"ref",k),d(a,"latency",h?0:200),a)),e.createElement(E,{ref:k,className:"lightbox-image",style:I({transform:s([_,R,A],(function(e,n,t){return"translate(".concat(n,"px, ").concat(t,"px) scale(").concat(e,")")})),maxHeight:f},g&&{willChange:"transform"}),src:u,alt:m,draggable:"false",onDragStart:function(e){e.preventDefault()},onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}})},E=i(u.img).withConfig({displayName:"Image__AnimatedImage",componentId:"sc-1k35vrn-0"})(["width:auto;max-width:100%;user-select:none;::selection{background:none;}"]),D=function(i){var l=i.images,c=i.currentIndex,s=i.onPrev,u=i.onNext,f=i.onClose,d=i.renderImageOverlay,g=i.renderCustomComponent,v=i.singleClickToZoom,h=r(!0),y=r(a(Array(l.length)).map((function(){return e.createRef()}))),b=function(){var e=t({width:window.innerWidth,height:window.innerHeight}),r=o(e,2),i=r[0],a=r[1];return n((function(){var e=function(){window.innerHeight===i.height&&window.innerWidth===i.width||a({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),function(){window.removeEventListener("resize",e),window.addEventListener("orientationchange",e)}})),i}(),C=b.height,w=b.width,x=t(!1),P=o(x,2),O=P[0],I=P[1],E=t("100%"),D=o(E,2),R=D[0],A=D[1],S=t(!1),B=o(S,2),H=B[0],L=B[1],X=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(e-c)*w+(n?t:0);return e<c-1||e>c+1?{x:r,display:"none"}:{x:r,display:"flex"}},Y=m(l.length,X),W=o(Y,2),Z=W[0],z=W[1];n((function(){var e=y.current[c].current.clientHeight-50;R!==e&&A(e)}),[c,R,C]),n((function(){h.current?h.current=!1:z(X)}));var U=p({onDrag:function(e){var n=e.down,t=o(e.movement,1)[0],r=o(e.direction,1)[0],i=e.velocity,a=e.distance,l=e.cancel,c=e.touches;if(!O&&0!==t){H||L(!0);var m=Math.abs(r)>.7;if(n&&m&&a>w/3.5||n&&m&&i>2){var f=r>0?-1:1;l(),f>0?u():f<0&&s()}c>1||z((function(e){return X(e,n,t)}))}},onDragEnd:function(){return L(!1)}},{domTarget:y.current[c],event:{passive:!0,capture:!1},enabled:Boolean(!l[c].disableDrag||l.length>1)});return n((function(){U()}),[U,l,c]),Z.map((function(n,t){var r=n.x,i=n.display;return e.createElement(T,{role:"presentation",ref:y.current[t],key:t,className:"lightbox-image-pager",style:{display:i,transform:r.to((function(e){return"translateX(".concat(e,"px)")}))},onClick:function(){return Math.abs(r.value)<1&&!O&&f()}},g({attachment:l[t],index:t,currentIndex:c}),e.createElement(j,null,e.createElement(N,null,e.createElement(_,{onClick:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},e.createElement(k,{setDisableDrag:I,src:l[t].src,alt:l[t].alt,pagerHeight:R,isCurrentImage:t===c,pagerIsDragging:H,singleClickToZoom:v}),d({attachment:l[t],index:t,currentIndex:c})))))}))},N=i.div.withConfig({displayName:"ImagePager__PagerInnerContentWrapper",componentId:"a18fy4-0"})(["display:flex;justify-content:center;align-items:center;"]),j=i.div.withConfig({displayName:"ImagePager__PagerContentWrapper",componentId:"a18fy4-1"})(["width:100%;display:flex;justify-content:center;"]),T=i(u.div).withConfig({displayName:"ImagePager__AnimatedImagePager",componentId:"a18fy4-2"})(["position:absolute;top:0px;left:0px;right:0px;bottom:0px;height:100%;width:100%;will-change:transform;touch-action:none;display:flex;flex-direction:column;justify-content:center;align-items:center;"]),_=i.div.withConfig({displayName:"ImagePager__ImageContainer",componentId:"a18fy4-3"})(["position:relative;touch-action:none;user-select:none;"]),R=function(n){var t=n.images,r=n.currentIndex,i=n.onPrev,o=n.onNext,a=n.onClose,l=n.renderPrevButton,c=n.renderNextButton,s=n.renderImageOverlay,u=n.renderCustomComponent,m=n.singleClickToZoom,f=r>0,p=r+1<t.length;return e.createElement(A,{className:"lightbox-image-stage"},l({canPrev:f}),e.createElement(D,{images:t,currentIndex:r,onClose:a,onNext:o,onPrev:i,renderImageOverlay:s,renderCustomComponent:u,singleClickToZoom:m}),c({canNext:p}))},A=i.div.withConfig({displayName:"ImageStage__ImageStageContainer",componentId:"m6g63l-0"})(["flex-grow:1;position:relative;height:100%;width:100%;display:flex;justify-content:center;align-items:center;"]);function S(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function B(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?S(Object(t),!0).forEach((function(n){d(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var H=function(n){var t=n.children,r=n.isOpen,i=n.className,o=(n.style,n.pageTransitionConfig),a={from:{transform:"scale(0.75)",opacity:0},enter:{transform:"scale(1)",opacity:1},leave:{transform:"scale(0.75)",opacity:0},config:B(B({},c.default),{},{mass:1,tension:320,friction:32})};return f(r,B(B({},a),o))((function(n,r,o,a){return r&&e.createElement(L,{key:a,className:"lightbox-container".concat(i?" ".concat(i):""),style:n},t)}))},L=i(u.div).withConfig({displayName:"PageContainer__AnimatedPageContainer",componentId:"sc-19m9s01-0"})(["display:flex;flex-direction:column;position:fixed;z-index:400;top:0;bottom:0;left:0;right:0;"]);function X(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=C(e);if(n){var i=C(this).constructor;t=Reflect.construct(r,arguments,i)}else t=r.apply(this,arguments);return b(this,t)}}var Y=function(e){y(t,e);var n=X(t);function t(){var e;g(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),d(h(e),"preventWheel",(function(e){return e.preventDefault()})),e}return v(t,[{key:"componentDidMount",value:function(){this.body=document.body,this.portalContainer=document.createElement("div"),this.portalContainer.setAttribute("class","lightbox-portal"),this.body.appendChild(this.portalContainer),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.body.removeChild(this.portalContainer)}},{key:"render",value:function(){if(void 0===this.portalContainer)return null;var e=this.props.children;return w.createPortal(e,this.portalContainer)}}]),t}(e.Component),W=function(t){var r=t.isOpen,i=t.onClose,o=t.images,a=t.currentIndex,l=t.onPrev,c=t.onNext,s=t.renderHeader,u=t.renderFooter,m=t.renderPrevButton,f=t.renderNextButton,p=t.renderImageOverlay,d=t.renderCustomComponent,g=t.renderCustomSidebar,v=t.className,h=t.singleClickToZoom,y=t.style,b=t.pageTransitionConfig;return n((function(){var e=function(e){r&&["ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key)&&e.preventDefault()},n=function(e){if(r)switch(e.key){case"ArrowLeft":l();break;case"ArrowRight":c();break;default:e.preventDefault()}};return document.addEventListener("keyup",n),document.addEventListener("keydown",e),function(){document.removeEventListener("keyup",n),document.removeEventListener("keydown",e)}})),e.createElement(Y,null,e.createElement(H,{isOpen:r,className:v,style:y,pageTransitionConfig:b},s(),e.createElement("div",{className:"view-container"},e.createElement(Z,null,e.createElement(R,{images:o,onClose:i,currentIndex:a,onPrev:l,onNext:c,renderPrevButton:m,renderNextButton:f,renderImageOverlay:p,renderCustomComponent:d,singleClickToZoom:h}),u()),g())))};W.defaultProps={pageTransitionConfig:null,className:null,style:null,renderHeader:function(){return null},renderFooter:function(){return null},renderPrevButton:function(){return null},renderNextButton:function(){return null},renderImageOverlay:function(){return null},renderCustomComponent:function(){return null},renderCustomSidebar:function(){return null},singleClickToZoom:!1};var Z=i.div.withConfig({displayName:"src__ViewContainer",componentId:"sc-1of2zfk-0"})(["display:flex;flex-direction:column;position:relative;z-index:400;top:0;bottom:0;left:0;right:0;width:100%;"]);export default W;
//# sourceMappingURL=index.es.js.map
